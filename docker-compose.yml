version: "3.9"
networks:
  default:
    name: atw-net
services:
  db:
    container_name: atw-db
    image: mongo:5
    ports:
      - 27018:27017
  stripe:
    container_name: atw-stripe
    image: stripe/stripe-cli:v1.10.3
    environment:
      - STRIPE_API_KEY=$STRIPE_API_KEY
    command: listen --forward-to atw-fe:3000/api/user/payment
  api:
    container_name: atw-api
    build:
      context: .
      dockerfile: config/Dockerfile.api
      args:
        - PAT=$PAT
        - AUTH_SECRET=$AUTH_SECRET
        - EMAIL_PASS=$EMAIL_PASS
    command: yarn start-local
    ports:
      - "9000:9000"
  fe:
    container_name: atw-fe
    build:
      context: .
      dockerfile: config/Dockerfile.fe
      args:
        - PAT=$PAT
        - AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
        - AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
    command: yarn start-dev
    ports:
      - "3000:3000"
      - "8000:8000"
  shared:
    container_name: atw-shared
    build:
      context: .
      dockerfile: config/Dockerfile.shared
      args:
        - PAT=$PAT
