version: "3.9"
networks:
  default:
    name: atw-net
services:
  db:
    container_name: atw-db
    image: mongo:5
    ports:
      - 27018:27017
    environment:
      - MONGO_INITDB_DATABASE=db
      - MONGO_INITDB_ROOT_USERNAME=$MONGO_INITDB_ROOT_USERNAME
      - MONGO_INITDB_ROOT_PASSWORD=$MONGO_INITDB_ROOT_PASSWORD
  stripe:
    container_name: atw-stripe
    image: stripe/stripe-cli:v1.10.3
    environment:
      - STRIPE_API_KEY=$STRIPE_API_KEY
    command: listen --forward-to atw-fe:3000/api/user/payment
  api:
    container_name: atw-api
    build:
      context: .
      dockerfile: config/Dockerfile.api
      args:
        - PAT=$PAT
        - AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
        - AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
        - AUTH_SECRET=$AUTH_SECRET
        - EMAIL_PASS=$EMAIL_PASS
        - MONGO_INITDB_ROOT_USERNAME=$MONGO_INITDB_ROOT_USERNAME
        - MONGO_INITDB_ROOT_PASSWORD=$MONGO_INITDB_ROOT_PASSWORD
        - MONGO_URI_PROD=$MONGO_URI_PROD
        - MONGO_URI_STAGING=$MONGO_URI_STAGING
        - MONGO_URI_MASTER=$MONGO_URI_MASTER
        - MONGO_URI_TEST=$MONGO_URI_TEST
        - MONGO_URI_LOCAL=$MONGO_URI_LOCAL
    command: yarn start-local
    ports:
      - "9100:9100"
  fe:
    container_name: atw-fe
    build:
      context: .
      dockerfile: config/Dockerfile.fe
      args:
        - PAT=$PAT
        - AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
        - AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
        - API_PATH=$API_PATH
    command: yarn start-dev
    ports:
      - "3100:3100"
      - "8100:8100"
  shared:
    container_name: atw-shared
    build:
      context: .
      dockerfile: config/Dockerfile.shared
      args:
        - PAT=$PAT
